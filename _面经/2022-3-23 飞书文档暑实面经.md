# 2022-3-23 飞书文档暑实面经

## 一面

1. **有没有遇到过 Google 都查不到的问题**: 写狼人杀的时候动态渲染按钮, 使用 vue3 的 `h` 函数, 找不到相关文章, 直到翻源码才搞清楚
2. **CPU 有几级缓存**: 答了快表和普通缓存
3. **如何判断链表有没有环**: 一开始说了双指针的做法, 追问**如何用缓存的思想实现**, 答: 用 `WeakSet` 存遇到过的节点, 如果出现重复的说明有环

   ```ts
   type ListNode = {
     val: number;
     next: ListNode;
   } | null;

   function hasLoop(node: ListNode): boolean {
     const set = new WeakSet<ListNode>();

     while (node) {
       if (set.has(node)) return true;
       set.add(node);
       node = node.next;
     }

     return false;
   }
   ```

4. **实现深拷贝, 要处理循环引用, 使用上述缓存思想**: 代码如下 👇, 问了要不要处理 function 和 Symbol, 面试官说既然你说了说明你是懂的, 就不写了

   ```ts
   function deepClone(object: any) {
     if (typeof object !== "object" || !object) {
       return object;
     }

     const objectMap = new WeakMap<object, object>();

     function clone(o: any) {
       if (typeof o !== "object" || !o) {
         return o;
       }
       if (objectMap.has(o)) return objectMap.get(o);

       const newObject = {};

       for (const key in o) {
         const newVal = clone(o[key]);
         objectMap.set(o[key], newVal);
         newObject[key] = newVal;
       }

       return newObject;
     }

     return clone(object);
   }
   ```

5. **二叉树的最大深度**: 代码如下 👇

   ```ts
   type Tree = {
     val: number;
     left: Tree;
     right: Tree;
   } | null;

   function maxDepth(root: Tree): number {
     if (!root) return 0;

     const leftDepth = maxDepth(root.left);
     const rightDepth = maxDepth(root.right);

     return Math.max(leftDepth, rightDepth) + 1;
   }
   ```

6. **讲讲 react fiber 架构**: 差不多讲出来了
7. **手写一下 fiber 中的时间调度方法**: 伪代码如下 👇

   ```ts
   const tasks = [];

   function call(timeleft = 16) {
     if (timeleft <= 0) {
       // ...
       return setTimeout(call, 0);
     }
     const start = Date.now();
     tasks.shift()();
     const end = Date.now();

     call(timeleft - (end - start));
   }
   ```

8. **讲讲 koa 的洋葱架构**: 讲出来了, 虽然语言组织比较混乱(
