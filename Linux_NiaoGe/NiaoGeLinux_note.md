# 《鸟哥的Linux私房菜》读书笔记

## 4 基本操作

记住以下一些命令,不会就问：

- <b>[Tab], [Ctrl]+c, [Ctrl+]+d  
- [xxx --help]  
- [man xxx]</b>
  - 其中有[DATE(1)]之类的参数
    - 1 代表shell环境下可执行的操作
    - 5 代表配置文件或某些文件的格式
    - 8 代表管理员可以使用的管理命令
    - 更多可参见<b>[man man]</b>
  - 一般就看看*NAME, DESCRIPTION, OPTIONS*
  - 任何时候都可以输入<b>[/(一个字符串)]</b>来查找它(输入n/N来找下一个/上一个匹配项)
  - <b>[home]/[end]</b>转至开头/末尾

nano--文本编辑器

关机  

- [sync] 把内存里的数据写入硬盘
- [shutdown]
  - -h now/20:25/+10 关机
  - -r now/20:25/+10 重启
  - -k 'rebooting' 吓唬人

## 5 文件与目录

### 5.2 用户组/权限

输入 **ls -al**  

- 前10个字符
  - 第一个
    - [d] 代表目录
    - [-] 代表文件
      - 纯文本
      - 二进制
      - 数据文件
    - [|] 代表链接（快捷方式之类的）
    - [b] 区块设备文件（如软盘硬盘）
    - [c] 字符设备文件（如键盘鼠标）
    - [s] 数据接口文件
  - 后面9个分为3组
    - 分别是**拥有者，组成员，其他人**
    - rwx:读，写，执行
- 两个名字
  - 第一个代表拥有者
  - 第二个代表所属组
  
修改组/权限

- [ch(own/grp)]+[目标组]+[对象]
- [chmod]+[目标权限]+[对象]
  - 其中目标权限的表示
    - <b>[chmod 755 text.txt]</b>  
      r,w,x = 4,2,1，所以755表示-rwxr-xr-x

    - <b>[chmod u=rwx,go-x 1.txt]</b>  
      u = user, go = group + others, (a = all), [-]代表去除，[+]代表添加  
权限的意义

- [r] 可以用ls
- [w] 可以改动目录结构，包括：
  - 新建文件/文件夹
  - 删除文件/文件夹（不论他的权限是什么）
  - 重命名
  - 移动位置
- [x] 可以cd

### 5.3 目录配置

#### 5.3.1 FHS

> Filesystem Hierarchy Standard

输入[ ls -l / ]查询  

##### 根目录 (/)

FHS建议根目录所在分区越小越好，安装的软件最好不要和根目录放在同一个分区，保持根目录越小越好。  

FHS定义根目录应该有以下子目录才好：  

| 目录   | 应放置文件内容                                                                                                                                                                       |
| :----- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| /bin   | 放置单人维护模式下还能被使用的命令，可以被一<br>般用户使用，主要有cat, chmod, chown, date, mv, <br>mkdir, cp, bash等                                                                 |
| /boot  | 启动会用的文件， 包括内核文件与启动配置文件<br>等。内核常用文件名：vmlinuz                                                                                                           |
| /dev   | 任何设备和接口都以文件形式存在这里，在这里读<br>取文件就是读取设备。比较重要的有 /null, /zero,<br> /tty, /loop\*, /sd\*等                                                            |
| /etc   | 系统主要配置文件，例如账号密码、各种服务的启<br>动文件。一般都让查看，但只有root可以修改。<br>FHS建议不要放可执行文件在这里，规定要把/opt<br>放在这里，建议把/X11，/sgm，/xml 放在这 |
| /lib   | 放置启动时的函数库和在/bin、/sbin下面的命令<br>会调用的函数库。FHS要求里面要有/modules这个<br>目录                                                                                   |
| /midia | 放可删除的设备，包括软盘、光盘等                                                                                                                                                     |
| /mnt   | 暂时挂载某些设备，和/media差不多                                                                                                                                                     |
| /opt   | 给第三方辅助软件放置的目录（如桌面管理系统                                                                                                                                           |
| /run   | 放置系统运行时产生的各项信息，可以使用内存来模拟                                                                                                                                     |
| /sbin  | 启动过程中要的信息，包括启动、修复、还原系<br>统所需的命令。常见的有fdisk，fsck，ifconfig，<br>mkfs 等                                                                               |
| /srv   | 放置网络服务所需要用到的数据，如WWW，FTP<br>等                                                                                                                                       |
| /tmp   | 用户正在执行的程序暂时存放数据的目录，任何<br>人都可以读取，要定期清理                                                                                                               |
| /sys   | （并非标准内，但也重要）记录内核和系统硬件<br>相关信息                                                                                                                               |
| /usr   | 第二层，稍后再详解                                                                                                                                                                   |
| /var   | 第二层，稍后再详解                                                                                                                                                                   |

##### /usr

> UNIX Software Resource

可分享，不可变动  
建议的目录：  

| 目录         | 应放置文件内容                                                                                                                              |
| :----------- | :------------------------------------------------------------------------------------------------------------------------------------------ |
| /usr/bin     | 放置一般用户能使用的命令，CentOS 7 已经把<br>所有用户命令放在这里了，即/usr/bin == /bin <br>，/bin链接到这里，FHS规定这里面不能有子目<br>录 |
| /usr/lib     | 基本==/lib，/lib链接到这里                                                                                                                  |
| /usr/local   | 安装自己下载的软件（非发行版默认提供的）                                                                                                    |
| /usr/sbin    | 最常见是网络服务软件的服务命令，基本功能<br>和/sbin差不多，/sbin链接到这里                                                                  |
| /usr/share   | 主要放只读的数据文件，几乎全是文本文<br>件，如/man，/doc，/zoneinfo                                                                         |
| /usr/include | （不是必须）c/c++头文件                                                                                                                     |
| /usr/src     | （不是必须）源代码一般放这                                                                                                                  |

##### /var

主演针对经常变动的文件，包括缓存(cache)，日志文件(log file)，以及某些软件运行产生的文件（lock file, run file)，或者例如MySQL的文件等  
要求的子目录有：  

| 目录         | 应放置文件内容                                                                   |
| :----------- | :------------------------------------------------------------------------------- |
| /var/cache   | 应用程序运行本身产生的缓存                                                       |
| /var/lib     | 程序执行过程中需要使用的数据文件放置的<br>目录，各自有各自的目录                 |
| /var/lock    | 需要确保一次只能一个用户使用的文件存在<br>这（如刻录机），目前已经挪到/run/lock  |
| **/var/log** | **极其重要!!** 是日至文件放置的目录，重要的<br>有/message，/wtmp（记录登陆信息） |
| /var/mail    | 放个人邮箱。通常和/var/spool/mail互相链<br>接                                    |
| /var/spool   | 放队列数据（排队等其他程序使用的数据，<br>通常完事了会被删掉）                   |

其他参见FHS官方文档  

---

## 6 Linux文件与目录管理

### 6.1 目录与路径

特殊目录：  

- [ . ] 当前目录
- [ .. ] 上层目录
- [ - ] 前一个工作目录
- [ ~ ] 目前使用者的/home
- [ ~xxx ] xxx的/home
- [  ] (对，什么也没有) == ~

常见处理目录的命令：

- [ cd ] 切换(善用[Tab]补全目录)
- [ pwd ] 显示当前目录的绝对路径(默认考虑链接)(print working directory)(-p 依次建立所有沿途的目录)
- [ mkdir ] 建立目录 (-m 设置权限)
- [rmdir ] 删除目录 (-p 依次删除沿途**空目录**)

关于$PATH：

> echo $XXX 表示显示XXX**这个变量的值**

e.g. 为什么在任何地方执行ls都能找到命令？  
因为PATH这个环境变量里设置了/bin这个目录，系统会依次在环境变量中找你输入的命令  
如何添加环境变量？  
e.g. 加入/root这个目录：  

    PATH="${PATH}:/root"

### 6.2 文件与目录管理

**ls：** ll == ls -l  

**cp：** 默认是不会复制权限等信息的，需要read权限，可以复制多个文件到最后的目标文件夹  

- -i  如果遇到重名会询问
- -a  复制所有信息
- -r  递归复制
- -p  连同文件属性一起复制
- -s  创建快捷方式
- -u  只在要复制的文件更“新”的时候才复制

**rm**  

- -f  忽略不存在的文件，不发出警告
- -I  交互模式，会询问
- -r  递归进行！！危！！
- rmdir  删除目录

**touch**：产生一个空文件/或者修改某一个文件的时间属性  

**mv**：见[ cp ]，可用于重命名

### 6.3 文件内容的查看

- **cat**：从第一行开始显示  
- **tac**：从最后一行显示  
- **nl**：显示行号(==cat -n)  
- **more**：一页一页的显示内容(较为常用，输入/xxx来找字符串，按空格翻页)  
- **less**：比more更好月，可以用pg up/pg dn  
- **head**：只看前面几行  
- **tail**：只看后面几行  
- **od**：二进制形式读取  

### 6.4 文件权限

#### 6.4.1 默认属性：umask

默认权限：

- 文件：666
- 目录：777

命令行输入umask[-S]：显示4个数字，除了第一个数字，依次代表ugo**被从默认权限李拿掉**的权限  
输入umask xxx来修改  

#### 6.4.2 隐藏属性

**stat xxx**：查看隐藏属性  
**chattr [-+=] xxx**：改变文件的参数

- -a  设置后他只能添加数据（只有root可以设置这个）
- -i  可以让文件[不能删除、改名、设置链接也无法写入或者新增数据（只有root可以设置这个）

**lsattr**：显示隐藏属性  

#### 6.4.3 文件特殊权限

##### SUID

当s这个标志出现在文件拥有者的x权限上时，称他获取了SUID的特殊权限，基本上SUID有这样的限制和功能：

- 仅对二进制文件有效
- 执行者需要对该程序有x的权限
- 本权限仅在执行中有效
- 执行者将拥有该程序拥有者的权限
- 不能用在shell脚本上/目录上

##### SGID

当s这个标志出现在用户组的x权限上时，称他获取了SGID的特殊权限  

对于文件：  

- 对二进制程序有用
- 执行者需要有x权限
- 执行者在执行过程中会获得用户组的支持

对于目录：  

- 用户要有r+x才能进入
- 用户在此目录下的有效用户组将变成该目录的用户组
- 若该用户在此目录下具有w权限，则他新建的文件的用户组为目录的用户组

##### SBIT

只对目录有效：将目录设为SBIT意味着进来的人只能写入/删除自己的文件，动不了别人的东西  

##### 如何设置

在正常权限前加一个数字：

- 4  SUID(u+s)
- 2  SGID(g+s)
- 1  SBIT(o+t)

e.g.  

    chmod 4755 filename

将file改成[-rwsr-xr-x]，即SUID  

    chmod g+s test

将test改成SGID  

#### 6.4.4 file

    file filename

显示filename的文件基本信息  

### 6.5 命令与文件的查找

#### 6.5.1 脚本文件的查找

**which**：查找命令所在的路径(在PATH里找)  

#### 6.5.2 查找文件

##### whereis

在特定目录下查找二进制文件

##### locate

使用前要[sudo updatedb]  
可以找任何文件，而且不用全称  

##### find

加上详细绝对路径，可以加 [-mtime 4]来根据时间找  

- +4：4天前
- 4：第四天
- -4：最近4天

还可以加正则表达式  

## 7 文件与磁盘管理系统

暂时不想看哈哈哈哈  
略

## 8 文件与文件系统的压缩

### 8.2 常见压缩命令  

| 命令      |  拓展名   |
| --------- | :-------: |
| compress  |    *.Z    |
| zip       |   *.zip   |
| gzip      |  *.gzip   |
| bzip2     |   *.bz2   |
| xz        |   *.xz    |
| tar       |   *.tar   |
| tar+gzip  | *.tar.gz  |
| tar+bzip2 | *.tar.bz2 |
| tar+xz    | *.tar.xz  |

tar仅是打包，没有压缩

#### 8.2.1 gzip

解压用[ gzip -d ]  
压缩和解压都会删除原来的文件  
[ egrep ]可以在解压文件之前看一眼文件里的内容  

#### 8.2.2 bzip2

同gzip，压缩比更高

#### 8.2.3 xz

同上

### 8.3 tar

| 参数           | 作用                           |
| -------------- | ------------------------------ |
| -c             | 建立打包文件                   |
| -t             | 查看打包文件里有哪些文件名     |
| -x             | 解压缩                         |
| -z             | 进行gzip压缩并打包             |
| -j             | 进行bzip2压缩并打包            |
| -J             | 进行xz压缩并打包               |
| -v             | 执行过程中显示正在处理的文件名 |
| -f dest src    | 将src打包成dest                |
| -C             | 制定解压缩到的目录             |
| -p             | 保留原本的权限和属性           |
| -P             | 保留绝对路径                   |
| --exclude=FILE | 不将FILE打包                   |

常用：  

打包：  

    tar -jcv -f file.tar.bz2 file

查询：

    tar -jtv -f file.tar.bz2

解压：

    tar -jxv -f file.tar.bz2 -C directory

### 8.4 XFS文件系统的备份还原

略

### 8.5 刻录光盘

略

### 8.6 其他备份

略

---

### 9 vim

#### 9.2 vi的使用

三种模式：

- **一般命令模式**：默认模式，vi打开一个文件就是了，可以[复制，粘贴，删除]
- **编辑模式**：一般模式下按[i,I,o,O,a,A,r,R]之一进入编辑模式，按[Esc]退出
- **命令行模式**：一般模式下，按[:,/,?]之一进入命令行模式，可以查找、读取、保存、批量操作、退出、显示行号，按[Esc]退出

##### 移动光标

| 按键      | 效果             |
| --------- | ---------------- |
| h         | 左               |
| j         | 下               |
| k         | 上               |
| l         | 右               |
| 20j       | 下移20行         |
| ctrl+f    | page down        |
| ctrl+b    | page up          |
| ctrl+d    | 向下半页         |
| ctrl+u    | 向上半页         |
| 0         | 到行开头         |
| $         | 到行末尾         |
| H         | 到这一面的最开头 |
| G         | 文件末尾         |
| 20G       | 到第20行         |
| gg        | 到第一行         |
| 20[enter] | 下移20行         |

##### 查找与替换

    :1,$s/word1/word2/g[c]
  
从第一行到最后一行‘查找word1，替换为word2，并且询问确认

##### 删除、复制、粘贴

| 按键   | 操作                             |
| ------ | -------------------------------- |
| x,X    | x=del，X=backspace               |
| nx     | 删除n个字符                      |
| dd     | 删除一整行                       |
| ndd    | 删除n行                          |
| yy     | 复制光标所在一行                 |
| nyy    | 复制n行                          |
| p      | 将已经复制的文件在光标下一行粘贴 |
| P      | 在光标上一行粘贴                 |
| J      | 将光标所在行和下一行合并         |
| u      | undo                             |
| ctrl+r | redo                             |
| .      | 重复上一个操作                   |

##### 一般模式切换命令行模式

| 按键      | 操作                                |
| --------- | ----------------------------------- |
| :w        | 保存                                |
| :w!       | 甚至可以保存只读文件/权限够的情况下 |
| :q        | 退出                                |
| :q!       | 退出且不保存                        |
| :wq!      | 强制保存后退出                      |
| ZZ        | 保存后退出/若没修改就直接退出       |
| :w[xxx]   | 另存为xxx                           |
| :r[xxx]   | 将xxx的内容加到文件后面             |
| :set nu   | 显示行号                            |
| :set nonu | 取消显示行号                        |

*.swp 文件是默认的自动备份，当异常退出/协同工作时需要注意.swp文件

### 9.3 vim的额外功能

#### 9.3.1 可视化区块

| 按键   | 操作           |
| ------ | -------------- |
| v      | 选中经过的字符 |
| V      | 选中经过的行   |
| ctrl+v | 选中块块       |

#### 9.3.2 多文件编辑

首先 vim 多个文件（同时打开多个）

| 按键   | 操作           |
| ------ | -------------- |
| :n     | 编辑下一个文件 |
| :N     | 编辑上一个文件 |
| :files | 列出所有文件   |

#### 9.3.3 多窗口

| 按键      | 操作                       |
| --------- | -------------------------- |
| :sp[file] | 打开多窗口[打开另一个文件] |
| ctrl+w+j  | 移到下一个窗口             |
| ctrl+w+k  | 移到上一个窗口             |
| ctrl+w+q  | == :q == :close            |

#### 9.3.4 自动补全

| 按键          | 操作                   |
| ------------- | ---------------------- |
| ctrl+x ctrl+n | 以当前文件的内容来补齐 |
| ctrl+x ctrl+o | 以当内置语法来补齐     |

#### 9.3.5 设置环境

不写就是默认加一句[ :set ]  
基本都可以加 [ no ]  

| 按键           | 操作                             |
| -------------- | -------------------------------- |
| nu             | 行号有无                         |
| hlsearch       | 是否将查找的字符串高亮           |
| autoindent     | 是否自动缩进                     |
| backup         | 产生一个叫xxx~的文件保存原来内容 |
| all            | 显示所有设置                     |
| :set           | 显示非默认的设置                 |
| bg=dark        | 设置背景颜色                     |
| :syntax on/off | 是否高亮                         |

#### 9.3.6 vim常用总结

![vim](http://q5f6gj3dx.bkt.clouddn.com/vim.jpg)

---

## 10 BASH

### 10.2 Shell变量

#### 10.2.1 显示变量

    echo ${variable}
    echo $variable

#### 10.2.2 设置变量

    var=XXX
    var='this way $'
    var=that\ way\ \$
    var1="another $var"
    var2="$var1"$(pwd)${var1}
    unset var1
    export var "声明为全局变量

#### 10.2.3 常见变量及其功能

输入[ env ]查看环境变量

| 变量   | 说明                       |
| ------ | -------------------------- |
| HOME   | 用户的根目录               |
| MAIL   | 邮箱（不是文件夹，是文件） |
| PATH   | 查找路径                   |
| LANG   | 语系数据                   |
| RANDOM | 随机数                     |

[ set ]：观察所有变量（包括自定义/函数）  
  
**${PS1}** ：提示符的设置  

- [ \d ]：显示[星期/月/日]的时间
- [ \H ]：完整主机名
- [ \t ]：24小时制显示时间[H:M:S]
- [ \A ]：12小时制显示时间[H:M] 
- [ \u ]：目前账户的名称
- [ \v ]：BASH版本
- [ \w ]：完整目录
- [ \W ]：当前目录
- [ \\# ]：执行的第几个命令
- [ \$ ]：提示字符

e.g.  

    PS1='[#\#/\A/\W]\$ '
    [#115/22:46/Downloads]$ 
  
**\${\$}**：当前shell的进程号 
  
**read**：读取键盘输入进入后面的变量

    read [-p -t] variable

- -t 10：等待10秒
- -p 'xxx: '：可以接提示符

**declare,typ**：声明变量类型

    declare [-aixr] variable

- -a：将后面的变量声明为数组
- -i：整型
- -x：环境变量
- -r：read only，不能被更改

e.g.

    declare -i sum=1+2+3+4+5
    echo ${sum}
    10
    declare -a arr=([0]='p' [2]='Q')
    echo ${arr[2]}\ ${arr[@]}
    Q p Q

**ulimit**：限制每个用户的内存使用

- -H：严格限制
- -s：警告限制
- -a：不接其他任何东西，列出所有限制

单位是KB

**变量的删除、取代、替换**

略

---

### 10.3 命令别名/历史命令

**alias, unalias**：如下

    alias lm='ls -al'
    unalias lm
    alias    "查看所有设置

**history**

- !1000：执行第1000条命令
- !!：执行上一条
- !hi：执行上一条hi开头的命令

### 10.4 BASH shell的操作环境

    cat /etc/issue
    su 
    vim /etc/issue
    -----       -----
      \    \     /    /
       \    \   /    /
        \    \ /    /
         \         /
          \       /
           \     /
           /      \ 
          /        \
         /    /\    \
        /    /  \    \
       /    /    \    \
       -----      ----

#### 10.4.3-5 bash的环境配置文件

略

### 10.5 数据流重定向

#### 10.5.1 "<,>"

- <,<<：输入流
- \>,>>：输出流
- 2>,2>>：错误流

一个代表覆盖，两个代表追加  
0: 输入  
1: 输出  
2: 错误  

e.g.

    ls > /file1 2>> file2
    ls > /file1 2>&1  "==上面那个
    ls > /file1 2>> /dev/null "吃掉所有
    cat > /file1 < /file2 "==cp
    cat > /file1 << "eof"  
    "先建立一个文件叫/file1，从键盘读取输入直到'eof'停止（正常按ctrl+d）

#### 10.5.2 "; , && , ||"

[ ; ]e.g.  

    sync; sync; shutdown now

[ || , && ]

| 命令           | 效果                                                 |
| -------------- | ---------------------------------------------------- |
| cmd1 && cmd2   | 1.若1正确执行(0)则执行2<br>2.若1错误则(1)则不执行2   |
| cmd1 \|\| cmd2 | 1.若1正确执行(0)则不执行2<br>2.若1错误执行(1)则执行2 |

对他就是反着的！！！

e.g.

    cd /xxx && echo 'exist' || echo 'not exist'

### 10.6 pipe

cmd1 | cmd2 |cmd3  
cmd1 的stdout作为cmd2的stdin继续执行下去  

**cut, grep**：略

**sort, wc, uniq**：排序，统计，去重

**tee**：双重定向

e.g.

    last | tee -a /file | cut ...

-a == 追加

**tr**：删除，支持正则表达式  

**col -x**：将tab换成空格  

**xargs**：将前面命令的输出当成参数

e.g.

    echo root | xargs -p id == id root

**[ - ]**：占位符，代替前面的输出

---

## 11 正则表达式与文件格式化处理

| 特殊符号   | 代表意义           |
| ---------- | ------------------ |
| [:alnum:]  | alpha+num          |
| [:alpha:]  | -                  |
| [:blank:]  | tab+space          |
| [:cntrl:]  | 键盘上的控制键     |
| [:digit:]  | -                  |
| [:graph:]  | 除了空格符的所有   |
| [:lower:]  | -                  |
| [:punct:]  | 标点               |
| [:upper:]  | -                  |
| [:xdigit:] | 16进制会用到的字符 |

| 符号     | 意义                           |
| -------- | ------------------------------ |
| ^        | 行首                           |
| $        | 行尾                           |
| .        | 任意字符（至少1）              |
| *        | 重复前一个字符无穷次           |
| .*       | 任意字符无限次                 |
| \\\{\\\} | 指定前一个字符次数（需要转义） |

e.g.

    grep '[^a-z]22'
    grep "[^a-z]("
    grep "\.$"  "行尾的点
    grep "^$"  "空行
    grep "1[0-9]\{2,\}"  "1后面至少2个其他数字

**sed, printf, awk, diff**：略

---

## 12 shell脚本

[bash script](shell_demos.sh)

不同打开方式执行效果不同

- sh xxx.sh：在子bash中打开
- source xxx.sh：在父进程中打开

**test命令**：测试一些东西，和条件语句一起用

test -xxx

| 参数       | 效果              |
| ---------- | ----------------- |
| -e         | exist             |
| -f         | -e and is file    |
| -d         | ~dict             |
| -L         | ~link             |
| -rwx       | -                 |
| -eq/ne     | equal/not~        |
| -gt/lt     | greater/less than |
| -ge/le     | great or equal    |
| -z+str     | len(str)==0       |
| -n+str     | ~!=0              |
| str1==str2 | -                 |
| xx -a xx   | and               |
| xx -o xx   | or                |

另一种写法：空格用[ _ ]表示

    [_"${var1}"_==_"${var2}"_] || xxxx

**argc, argv**  

- ${#} == argc
- ${@} == argv[1:]
- ${1/2/3} == argv[1/2/3]

**shift**：略

### 脚本调试

    sh -[nvx] xxx.sh

- -n：不运行，仅检查语法，没输出代表没问题
- -v：将脚本内容打出来再显示问题
- -x：显示使用到的内容（产生相应输出的语句）

---

## 13-20 ：略

---

## 21 软件安装

### 21.1 make

make会按照makefile这个文件的指示自动完成编译链接的任务  

makefile基本语法:  
  
<命令名1>: file1.o file2.o file3.o ...  
\<tab\> gcc -o targetfile file1.o file2.o file3.o  
<命令名2(以clean为例)>:
\<tab\> rm -f main main.o file1.o file2.o file3.o  

简化版：  

OBJS = main.o file1.o file2.o file3.o  
main: ${OBJS}  
\<tab\> gcc -o main ${ONJS}  
clean:  
\<tab\> rm -f ${OBJS}  

一般流程：  

    ./comfig --prefix=/your_dic# 检查依赖，建立makefile文件
    make clean # 确保去掉了奇怪的东西
    make
    make install

